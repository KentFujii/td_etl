<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<match matsunoya>
  @type exec_filter
  command    /usr/bin/ruby /fluentd/etc/json_flatten.rb
  in_format  json
  out_format msgpack
  tag        parsed
  flush_interval 1s
</match>

<match **>
  @type cloudwatch_logs
  log_group_name matsunoya-parsed
  auto_create_stream true
  include_time_key true
  use_tag_as_stream true
  use_log_stream_name_prefix true
</match>

#<match parsed>
#  @type aws-elasticsearch-service
#  logstash_format true
#  logstash_prefix "#{ENV['ES_INDEX']}"
#  <endpoint>
#    url "#{ENV['ES_URL']}"
#    region "#{ENV['AWS_REGION']}"
#  </endpoint>
#  <buffer>
#    flush_at_shutdown true
#    flush_mode immediate
#    flush_thread_count 2
#    flush_thread_interval 1
#    flush_thread_burst_interval 1
#    retry_forever true
#    retry_type exponential_backoff
#  </buffer>
#</match>
